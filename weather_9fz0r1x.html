<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="no-referrer">
<title>Weather + Air Quality Widget</title>
<style>
  body {
    margin: 0;
    background: #1a1a1a;
    color: #eaeaea;
    font-family: "Inter", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .weather-bar {
    display: flex;
    align-items: center;
    justify-content: space-around;
    width: 600px;
    background: #242424;
    border-radius: 12px;
    padding: 12px 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.4);
  }
  .temp {
    font-size: 1.8rem;
    font-weight: 600;
    color: #ffffff;
  }
  .air {
    font-weight: 600;
  }
  .air.good { color: #4fa3ff; }
  .air.normal { color: #7ed957; }
  .air.bad { color: #ff9b4a; }
  .air.verybad { color: #f35a5a; }
  .icon-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.9rem;
    color: #cfd2d6;
  }
  .icon-block img {
    width: 28px;
    height: 28px;
    margin-bottom: 4px;
  }
</style>
</head>
<body>
  <div class="weather-bar">
    <div class="air" id="air">Loading...</div>
    <div class="temp" id="temp">--°C</div>
    <div class="icon-block"><img id="nowIcon" alt=""><span>지금</span></div>
    <div class="icon-block"><img id="morningIcon" alt=""><span>오전</span></div>
    <div class="icon-block"><img id="noonIcon" alt=""><span>낮</span></div>
    <div class="icon-block"><img id="eveningIcon" alt=""><span>저녁</span></div>
  </div>

<script>
const serviceKey = "3c85c571c5d7ec71beb5cf7af70fdae04c1f6e281cfac671a4604aedb9f7781a"; // 발급받은 인증키

async function getAirQuality() {
  const url = `https://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?serviceKey=${serviceKey}&returnType=json&sidoName=경기&ver=1.0`;
  const res = await fetch(url);
  const data = await res.json();
  const list = data.response.body.items;
  const gimchon = list.find(x => x.stationName.includes("금촌"));
  if (!gimchon) {
    document.getElementById("air").textContent = "금촌2동 데이터 없음";
    return;
  }
  const grade = gimchon.khaiGrade;
  const airEl = document.getElementById("air");
  let text = "", cls = "";
  switch (grade) {
    case "1": text = "좋음"; cls = "good"; break;
    case "2": text = "보통"; cls = "normal"; break;
    case "3": text = "나쁨"; cls = "bad"; break;
    case "4": text = "매우나쁨"; cls = "verybad"; break;
    default: text = "정보없음"; cls = "";
  }
  airEl.textContent = `미세먼지 ${text}`;
  airEl.className = `air ${cls}`;
}

async function getWeather() {
  const icons = {
    0:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/clear-day.svg",
    1:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/partly-cloudy-day.svg",
    2:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/cloudy.svg",
    3:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/overcast.svg",
    45:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/fog.svg",
    48:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/fog.svg",
    51:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/drizzle.svg",
    61:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/rain.svg",
    71:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/snow.svg",
    80:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/showers.svg",
    95:"https://raw.githubusercontent.com/basmilius/weather-icons/dev/production/fill/svg/thunderstorms.svg"
  };
  const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=37.75&longitude=126.78&current_weather=true&hourly=temperature_2m,weathercode&timezone=Asia/Seoul");
  const data = await res.json();
  document.getElementById("temp").textContent = `${Math.round(data.current_weather.temperature)}°C`;

  const hourly = data.hourly;
  const nowHour = new Date().getHours();
  const getIcon = (targetHour) => {
    const idx = hourly.time.findIndex(t => t.includes(`T${String(targetHour).padStart(2,"0")}:00`));
    const code = hourly.weathercode[idx];
    return icons[code] || icons[1];
  };
  document.getElementById("nowIcon").src = getIcon(nowHour);
  document.getElementById("morningIcon").src = getIcon(9);
  document.getElementById("noonIcon").src = getIcon(14);
  document.getElementById("eveningIcon").src = getIcon(19);
}

getAirQuality();
getWeather();
</script>
</body>
</html>
