<!DOCTYPE html>
<html lang="ko">
<head>
    <meta name="color-scheme" content="dark light">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Dashboard</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: transparent;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .widget-container {
            width: 440px;
            height: 310px;
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 40px rgba(216, 180, 254, 0.1);
            display: flex;
            flex-direction: column; 
            padding: 16px 20px;
            gap: 10px;
            overflow: hidden;
            color: #334155;
        }
        
        .section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 14px;
            padding: 10px 14px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* [수정] 가로 배치를 위한 그리드 아이템 스타일 */
        .grid-item {
            display: flex;
            align-items: center;
            justify-content: space-between; /* 라벨과 블록 양끝 정렬 */
            height: 18px; /* 행 높이 고정 */
        }
        
        .item-label {
            font-size: 10px; /* 폰트 사이즈 미세 조정 */
            font-weight: 500;
            color: #64748b;
            white-space: nowrap; /* 줄바꿈 방지 */
            margin-right: 8px;
        }

        /* 블록 컨테이너 */
        .block-container {
            display: flex;
            gap: 2px;
        }
        /* 개별 블록 (기본) */
        .block {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            background-color: rgba(203, 213, 225, 0.4); /* slate-300 연하게 */
            transition: all 0.5s ease;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: { 300: '#d8b4fe', 100: '#f3e8ff' },
                        sky: { 300: '#7dd3fc', 100: '#e0f2fe', 400: '#38bdf8', 500: '#0ea5e9' },
                        yellow: { 200: '#fef08a', 400: '#facc15' },
                        slate: { 400: '#94a3b8', 600: '#475569' }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ★ 워커 주소를 확인해주세요
        const WORKER_URL = "https://project-worker.moonkelly601.workers.dev"; 

        // [컴포넌트] 5칸 블록 프로그래스 바
        const BlockBar = ({ percent, activeColor }) => {
            // 20% 단위로 반올림하여 채울 블록 수 계산 (0~5)
            const filledCount = Math.round(percent / 20);
            
            return (
                <div className="block-container">
                    {[...Array(5)].map((_, i) => (
                        <div 
                            key={i} 
                            className={`block ${i < filledCount ? activeColor : ''}`}
                        ></div>
                    ))}
                </div>
            );
        };

        const GoalWidget = () => {
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetch(WORKER_URL)
                    .then(res => res.json())
                    .then(json => {
                        setData(json);
                        setLoading(false);
                    })
                    .catch(e => setLoading(false));
            }, []);

            if (loading) return <div className="widget-container items-center justify-center"><div className="text-xs text-slate-400">Syncing...</div></div>;
            if (!data) return <div className="widget-container">Error</div>;

            const { goals, monthly, weekly, feedback } = data;
            
            return (
                <div className="widget-container">
                    
                    {/* 1. Keyword Block */}
                    <div className="flex gap-2 shrink-0">
                        {goals.keywords.map((k, i) => (
                            <div key={i} className="flex-1 bg-purple-100/60 border border-purple-300/40 rounded-lg py-1.5 px-2 text-center shadow-sm">
                                <span className="text-[11px] font-bold text-slate-600 block">{k}</span>
                            </div>
                        ))}
                    </div>

                    {/* 2. Monthly Goal (Blue Theme) */}
                    <div className="glass-card bg-sky-50/30 border-sky-200/40">
                        <div className="section-title text-sky-500">
                            Monthly Objective
                        </div>
                        {/* 2열 그리드 */}
                        <div className="grid grid-cols-2 gap-x-6 gap-y-1">
                            {monthly.map((item, i) => (
                                <div key={i} className="grid-item">
                                    <span className="item-label">{item.label}</span>
                                    {/* 블록 컴포넌트: Sky 색상 */}
                                    <BlockBar percent={item.percent} activeColor="bg-sky-400 shadow-[0_0_4px_rgba(56,189,248,0.4)]" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 3. Weekly Focus (Yellow Theme) */}
                    <div className="glass-card bg-yellow-50/30 border-yellow-200/50">
                        <div className="section-title text-yellow-500" style={{ color:'#d97706' }}>
                            Weekly Focus
                        </div>
                        <div className="grid grid-cols-2 gap-x-6 gap-y-1">
                            {weekly.map((item, i) => (
                                <div key={i} className="grid-item">
                                    <span className="item-label">{item.label}</span>
                                    {/* 블록 컴포넌트: Yellow 색상 */}
                                    <BlockBar percent={item.percent} activeColor="bg-yellow-400 shadow-[0_0_4px_rgba(250,204,21,0.4)]" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 4. AI Feedback */}
                    <div className="bg-white/40 rounded-xl p-2.5 border border-white/60 flex gap-2.5 items-center shadow-sm shrink-0">
                        <div className="text-purple-400 shrink-0">
                            {/* 말풍선 아이콘 */}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        </div>
                        <p className="text-[11px] text-slate-600 leading-snug font-medium line-clamp-2">
                            {feedback}
                        </p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GoalWidget />);
    </script>
</body>
</html>
