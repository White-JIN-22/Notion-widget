<!DOCTYPE html>
<html lang="ko">
<head>
    <meta name="color-scheme" content="dark light">
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Input</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: transparent;
            margin: 0;
            padding: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .widget-container {
            width: 190px;
            height: 335px;
            background: linear-gradient(135deg, rgba(224, 242, 254, 0.25) 0%, rgba(186, 230, 253, 0.15) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(186, 230, 253, 0.2), inset 0 0 20px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            padding: 16px;
        }

        .input-field {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: rgba(125, 211, 252, 0.6);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .submit-btn {
            width: 100%;
            padding: 10px 14px;
            border: none;
            border-radius: 10px;
            background: rgba(125, 211, 252, 0.4);
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn:hover:not(:disabled) {
            background: rgba(125, 211, 252, 0.6);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            gap: 12px;
        }

        .book-cover {
            width: 60px;
            height: 85px;
            border-radius: 4px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(125, 211, 252, 0.3);
            color: rgba(255, 255, 255, 0.9);
            font-size: 10px;
            margin-right: 4px;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 40, 40, 0.9);
            backdrop-filter: blur(8px);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            animation: fadeInOut 3s ease-in-out forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }
        
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const WORKER_URL = "https://book-info-worker.moonkelly601.workers.dev";

        // 아이콘
        const IconBook = ({ className, color }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
        );

        const IconCheck = ({ className, color }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const IconLoader = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M9.76 14.24l-2.83 2.83m0-10.14l2.83 2.83m4.48 4.48l2.83 2.83" strokeLinecap="round"/>
            </svg>
        );

        const App = () => {
            const [title, setTitle] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!title.trim() || loading) return;

                setLoading(true);
                setError('');
                setResult(null);

                try {
                    const res = await fetch(WORKER_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ title: title.trim() })
                    });

                    const data = await res.json();

                    if (data.success) {
                        setResult(data);
                        setTitle('');
                        setSuccess('노션에 등록 완료!');
                        setTimeout(() => setSuccess(''), 3000);
                    } else {
                        setError(data.error || '등록 실패');
                        setTimeout(() => setError(''), 3000);
                    }
                } catch (e) {
                    setError('네트워크 오류');
                    setTimeout(() => setError(''), 3000);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="widget-container">

                    {/* 입력 폼 */}
                    <form onSubmit={handleSubmit} className="space-y-3">
                        <input
                            type="text"
                            className="input-field"
                            placeholder="책 제목을 입력하세요"
                            value={title}
                            onChange={(e) => setTitle(e.target.value)}
                            disabled={loading}
                        />
                        <button 
                            type="submit" 
                            className="submit-btn"
                            disabled={!title.trim() || loading}
                        >
                            {loading ? (
                                <span className="flex items-center justify-center gap-2">
                                    <IconLoader className="w-4 h-4 animate-spin" />
                                    검색 중...
                                </span>
                            ) : '등록하기'}
                        </button>
                    </form>

                    {/* 토스트 */}
                    {error && (
                        <div className="toast">{error}</div>
                    )}
                    {success && (
                        <div className="toast" style={{ background: 'rgba(34, 197, 94, 0.9)' }}>{success}</div>
                    )}

                    {/* 결과 */}
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className="flex items-center gap-2 text-[12px] text-green-300">
                                <IconCheck className="w-4 h-4" color="#86efac" />
                                노션에 등록 완료!
                            </div>
                            
                            <div className="result-card">
                                {result.book.cover && (
                                    <img 
                                        src={result.book.cover} 
                                        alt={result.book.title}
                                        className="book-cover"
                                    />
                                )}
                                <div className="flex-1 min-w-0">
                                    <div className="text-[12px] font-semibold text-white truncate">
                                        {result.book.title}
                                    </div>
                                    {result.book.author && (
                                        <div className="text-[11px] text-white/70 truncate mt-0.5">
                                            {result.book.author}
                                        </div>
                                    )}
                                    {result.book.publisher && (
                                        <div className="text-[10px] text-white/50 mt-0.5">
                                            {result.book.publisher}
                                        </div>
                                    )}
                                    {result.book.categories?.length > 0 && (
                                        <div className="mt-2">
                                            {result.book.categories.map((cat, i) => (
                                                <span key={i} className="category-tag">{cat}</span>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <a 
                                href={result.notionUrl} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="block text-center text-[11px] text-sky-300 hover:text-sky-200 transition-colors"
                            >
                                노션에서 보기 →
                            </a>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
