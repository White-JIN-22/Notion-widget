<!DOCTYPE html>
<html lang="ko">
<head>
    <meta name="color-scheme" content="dark light">
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Widget</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: transparent;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        ::-webkit-scrollbar { display: none; }
        
        .widget-container {
            position: relative;
            width: 180px;
            height: 310px;
            background: linear-gradient(180deg, rgba(224, 242, 254, 0.25) 0%, rgba(240, 249, 255, 0.15) 100%);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(186, 230, 253, 0.15), inset 0 0 20px rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #334155;
        }

        .glass-bar {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            flex-shrink: 0;
            display: flex;
        }

        .border-b-glass { border-bottom: 1px solid rgba(255, 255, 255, 0.8); }
        .border-t-glass { border-top: 1px solid rgba(255, 255, 255, 0.8); }
        .border-r-glass { border-right: 1px solid rgba(255, 255, 255, 0.8); }
        
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: { 100: '#f3e8ff', 300: '#d8b4fe' },
                        sky: { 100: '#e0f2fe', 300: '#7dd3fc' },
                        yellow: { 100: '#fef9c3', 200: '#fef08a' },
                        slate: { 400: '#94a3b8', 600: '#475569' }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans KR"', '-apple-system', 'sans-serif'],
                        mono: ['"Roboto Mono"', 'monospace']
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Data API Setup ---
        const CALENDAR_API = "https://log-cal.moonkelly601.workers.dev/";
        
        // --- Icons ---
        // 1. 산책(전환) 아이콘 - 모양 수정됨
        const IconSparkle = ({ className, color, fill }) => (
            <svg className={className} viewBox="0 0 24 24" fill={fill ? color : "none"} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 2l3 7 7 3-7 3-3 7-3-7-7-3 7-3z"></path>
            </svg>
        );

        // 2. 기록(휴식) 아이콘 - 펜
        const IconPen = ({ className, color, fill }) => (
            <svg className={className} viewBox="0 0 24 24" fill={fill ? color : "none"} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l5.5 5.5"></path>
                <path d="M11 11l5.5 5.5"></path>
            </svg>
        );

        // 3. 식사 아이콘 - 포크나이프
        const IconUtensils = ({ className, color, fill }) => (
            <svg className={className} viewBox="0 0 24 24" fill={fill ? color : "none"} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                <path d="M7 2v20"></path>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"></path>
            </svg>
        );

        // 4. 위생(물방울) 아이콘 - 추가됨
        const IconDroplets = ({ className, color, fill }) => (
            <svg className={className} viewBox="0 0 24 24" fill={fill ? color : "none"} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
            </svg>
        );

        // 5. 독서(책) 아이콘 - 추가됨
        const IconBook = ({ className, color, fill }) => (
            <svg className={className} viewBox="0 0 24 24" fill={fill ? color : "none"} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
        );
        
        // Header Icons
        const IconSun = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2"></path><path d="M12 21v2"></path><path d="M4.22 4.22l1.42 1.42"></path><path d="M18.36 18.36l1.42 1.42"></path><path d="M1 12h2"></path><path d="M21 12h2"></path><path d="M4.22 19.78l1.42-1.42"></path><path d="M18.36 5.64l1.42-1.42"></path></svg>;
        const IconCloudSun = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="M20 12h2"></path><path d="m19.07 4.93-1.41 1.41"></path><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"></path><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"></path></svg>;
        const IconStar = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;

        // Weather & Dust Icons
        const Sun = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
        const Cloud = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>;
        const CloudRain = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="16" y1="13" x2="16" y2="21"></line><line x1="8" y1="13" x2="8" y2="21"></line><line x1="12" y1="15" x2="12" y2="23"></line><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"></path></svg>;
        const CloudSnow = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M8 15h.01"/><path d="M8 19h.01"/><path d="M12 17h.01"/><path d="M12 21h.01"/><path d="M16 15h.01"/><path d="M16 19h.01"/></svg>;
        const CloudLightning = ({ className, color }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973"/><path d="m13 12-3 5h4l-3 5"/></svg>;
        
        const FaceHappy = ({ color, className, strokeWidth }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>;
        const FaceNormal = ({ color, className, strokeWidth }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 1.5 4 1.5 4-1.5 4-1.5"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>;
        const FaceBad = ({ color, className, strokeWidth }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9 15s1.5-1 3-1 3 1 3 1"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/><path d="M8 7 L10 9"/><path d="M16 7 L14 9"/></svg>;
        const FaceDevil = ({ color, className, strokeWidth }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9 15s1.5-1 3-1 3 1 3 1"/><path d="M8 8l-2-2"/><path d="M16 8l2-2"/><line x1="9" y1="10" x2="9.01" y2="10"/><line x1="15" y1="10" x2="15.01" y2="10"/></svg>;
        const GasMask = ({ color, className, strokeWidth }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="9"/><circle cx="9" cy="10" r="2.5"/><circle cx="15" cy="10" r="2.5"/><path d="M12 14v3"/><rect x="10" y="17" width="4" height="3" rx="1"/></svg>;

        const TimelineWidget = () => {
            const [now, setNow] = useState(new Date());
            const [weather, setWeather] = useState({ temp: '--', code: 0 });
            const [dust, setDust] = useState({ aqi: 0, status: '…' });
            
            // Data States
            const [blocks, setBlocks] = useState([]);
            const [events, setEvents] = useState([]);
            const [missions, setMissions] = useState({ 
                morningMeal: false, morningWalk: false,
                afternoonMeal: false, afternoonWalk: false,
                nightMeal: false, nightRecord: false
            });

            const WAQI_TOKEN = "724216be2f8a00c8b378a9cde2a8744e669d11d7"; 
            const LAT = 37.5034; 
            const LON = 126.7660;

            // 1. Time Update
            useEffect(() => {
                const timer = setInterval(() => setNow(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            // 2. Weather & Dust Fetch
            useEffect(() => {
                const fetchData = async () => {
                    try {
                        const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`);
                        const wData = await wRes.json();
                        setWeather({
                            temp: Math.round(wData.current_weather.temperature),
                            code: wData.current_weather.weathercode
                        });

                        const dRes = await fetch(`https://api.waqi.info/feed/geo:${LAT};${LON}/?token=${WAQI_TOKEN}`);
                        const dData = await dRes.json();
                        if (dData.status === 'ok') {
                            setDust({
                                aqi: dData.data.aqi,
                                status: getDustStatus(dData.data.aqi)
                            });
                        }
                    } catch (e) { console.error(e); }
                };
                fetchData();
                const interval = setInterval(fetchData, 600000);
                return () => clearInterval(interval);
            }, []);

            // 3. User Data Fetch
            const isToday = (d) => d.toDateString() === new Date().toDateString();

            const loadLocalData = () => {
                const savedData = JSON.parse(localStorage.getItem('fortressData') || '{}');
                const today = new Date().toDateString();
                
                if (savedData.date === today && savedData.blocks) {
                    setBlocks(savedData.blocks);
                } else {
                    setBlocks([]);
                }
            };

            const fetchCalendar = async () => {
                try {
                    const calRes = await fetch(`${CALENDAR_API}?type=calendar`);
                    if (calRes.ok) {
                        const calData = await calRes.json();
                        if (Array.isArray(calData)) setEvents(calData);
                    }
                } catch (e) { }
            };

            useEffect(() => {
                loadLocalData();
                fetchCalendar();
                const localInterval = setInterval(loadLocalData, 3000);
                const calendarInterval = setInterval(fetchCalendar, 60000);
                return () => {
                    clearInterval(localInterval);
                    clearInterval(calendarInterval);
                };
            }, []);

            // 4. Mission Checking Logic (Strict Matching)
            useEffect(() => {
                // Helper
                const checkStatus = (startH, endH, keywords) => {
                    const hasEvent = events.some(ev => {
                        const evTime = new Date(ev.startTime);
                        const h = evTime.getHours();
                        if (!isToday(evTime)) return false;
                        if (h >= startH && h < endH) {
                            return keywords.some(k => ev.title && ev.title.includes(k));
                        }
                        return false;
                    });

                    const hasBlock = blocks.some(b => {
                        const bTime = new Date(b.startTime);
                        const h = bTime.getHours();
                        if (h >= startH && h < endH) {
                            if (b.duration >= 10) {
                                return b.task && keywords.some(k => b.task.includes(k));
                            }
                        }
                        return false;
                    });

                    return hasEvent || hasBlock;
                };

                // 키워드 정의
                const mealKeywords = ['식사'];
                const walkKeywords = ['산책'];
                const recordKeywords = ['기록'];
                const hygieneKeywords = ['위생관리'];
                const readingKeywords = ['독서']; // 추가됨

                setMissions({
                    // Morning (00-12) : 0시부터 12시까지 감지
                    morningMeal: checkStatus(0, 12, mealKeywords),
                    morningWalk: checkStatus(0, 12, walkKeywords),
                    morningHygiene: checkStatus(0, 12, hygieneKeywords),
                    
                    // Afternoon (12-18) : 식사 -> 산책 -> 독서
                    afternoonMeal: checkStatus(12, 18, mealKeywords),
                    afternoonWalk: checkStatus(12, 18, walkKeywords),
                    afternoonReading: checkStatus(12, 18, readingKeywords), // 추가됨
                    
                    // Night (18-24)
                    nightMeal: checkStatus(18, 24, mealKeywords),
                    nightWalk: checkStatus(18, 24, walkKeywords),
                    nightHygiene: checkStatus(18, 24, hygieneKeywords),
                    nightRecord: checkStatus(18, 24, recordKeywords)
                });
            }, [blocks, events, now]);


            // Helpers
            const getDustStatus = (aqi) => {
                if (aqi <= 50) return '좋음';
                if (aqi <= 100) return '보통';
                if (aqi <= 150) return '나쁨';
                if (aqi <= 250) return '매우나쁨';
                return '최악'; 
            };

            const getDustColor = (aqi) => {
                if (aqi <= 50) return '#d8b4fe';
                if (aqi <= 100) return '#7dd3fc';
                return '#94a3b8';
            };

            const getDustIcon = (aqi, color) => {
                const className = "w-4 h-4"; 
                const props = { color, className, strokeWidth: "2" };
                if (aqi <= 50) return <FaceHappy {...props} />;
                if (aqi <= 100) return <FaceNormal {...props} />;
                if (aqi <= 150) return <FaceBad {...props} />;
                if (aqi <= 250) return <FaceDevil {...props} />;
                return <GasMask {...props} />;
            };

            const getWeatherColor = (code) => {
                if (code === 0) return '#d8b4fe'; 
                if (code <= 3) return '#7dd3fc';  
                if (code >= 71) return '#94a3b8'; 
                return '#fef08a';                 
            };

            const getWeatherIcon = (code, color) => {
                const className = "w-4 h-4"; 
                const props = { color, className };
                if (code === 0) return <Sun {...props} />;
                if (code <= 3) return <Cloud {...props} />;
                if (code <= 48) return <CloudRain {...props} />;
                if (code >= 71 && code <= 77) return <CloudSnow {...props} />;
                if (code >= 85 && code <= 86) return <CloudSnow {...props} />;
                if (code >= 95) return <CloudLightning {...props} />;
                return <CloudRain {...props} />;
            };

            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const weekday = now.toLocaleDateString('en-US', { weekday: 'short' }).toUpperCase();
            const dateStr = `${month}/${day} ${weekday}`;
            const timeStr = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });

            const dustColor = getDustColor(dust.aqi);
            const weatherColor = getWeatherColor(weather.code);

            const START_HOUR = 6;
            const TOTAL_HOURS = 18;
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();
            let progress = 0;
            if (currentHour < START_HOUR) progress = 0;
            else if (currentHour >= 24) progress = 100;
            else {
                const elapsedMinutes = (currentHour - START_HOUR) * 60 + currentMin;
                progress = (elapsedMinutes / (TOTAL_HOURS * 60)) * 100;
            }

            return (
                <div className="widget-container">
                    
                    {/* [Header] Clock & Date */}
                    <div className="glass-bar border-b-glass h-[50px] px-4 flex items-baseline justify-between pt-4 pb-2">
                        <span className="text-2xl font-bold text-white tracking-tighter leading-none">
                            {timeStr}
                        </span>
                        <span className="text-[10px] font-bold text-white/90 tracking-tight">
                            {dateStr}
                        </span>
                    </div>

                    {/* [Body] Timeline + Content */}
                    <div className="flex-1 w-full flex flex-row relative overflow-hidden">
                        
                        {/* 1. Left Axis (Time) */}
                        <div className="w-[20px] h-full flex flex-col relative flex-shrink-0 border-r border-white/80"
                             style={{ background: 'rgba(255, 255, 255, 0.1)' }}>
                            
                            <div className="absolute top-2 w-full text-center text-[9px] font-mono font-bold text-purple-300">06</div>

                            <div className="absolute top-[33.33%] w-full h-[1px] bg-sky-300"></div>
                            <div className="absolute top-[33.33%] w-full text-center mt-1 text-[9px] font-mono font-bold text-sky-300">12</div>
                            
                            <div className="absolute top-[66.66%] w-full h-[1px] bg-yellow-200"></div>
                            <div className="absolute top-[66.66%] w-full text-center mt-1 text-[9px] font-mono font-bold text-yellow-200">18</div>
                            
                            {/* Current Time Bar */}
                            <div 
                                className="absolute w-full flex items-center z-20 transition-all duration-500"
                                style={{ top: `${progress}%` }}
                            >
                                <div className="w-full h-[2px] bg-white shadow-[0_0_6px_rgba(255,255,255,0.8)]"></div>
                            </div>
                        </div>

                        {/* 2. Right Content (Zones) */}
                        <div className="flex-1 h-full flex flex-col">
                            
                            {/* MORNING */}
                            <div className="flex-1 w-full relative p-2 flex flex-col overflow-hidden group">
                                <div className="absolute inset-0 bg-purple-300 opacity-[0.25] group-hover:opacity-[0.35] transition-opacity"></div>
                                
                                <div className="relative z-10 flex items-start justify-between mb-0.5">
                                    <div className="flex items-center gap-1.5 mt-0.5">
                                        <IconSun className="w-3.5 h-3.5" color="#d8b4fe" />
                                        <span className="text-[11px] font-bold text-purple-300 tracking-wide uppercase">Morning</span>
                                    </div>
                                    
                                    {/* Indicators: 식사 -> 산책 -> 위생 */}
                                    <div className="absolute right-0.5 top-0.5 flex flex-col items-end gap-1 z-20">
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.morningMeal ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconUtensils className={`w-3 h-3 ${missions.morningMeal ? 'drop-shadow-[0_0_8px_rgba(216,180,254,1)]' : ''}`} color="#d8b4fe" fill={missions.morningMeal} />
                                            <span className={`text-[9px] font-bold ${missions.morningMeal ? 'text-purple-300' : 'text-white'}`}>식사</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.morningWalk ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconSparkle className={`w-3 h-3 ${missions.morningWalk ? 'drop-shadow-[0_0_8px_rgba(216,180,254,1)]' : ''}`} color="#d8b4fe" fill={missions.morningWalk} />
                                            <span className={`text-[9px] font-bold ${missions.morningWalk ? 'text-purple-300' : 'text-white'}`}>산책</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.morningHygiene ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconDroplets className={`w-3 h-3 ${missions.morningHygiene ? 'drop-shadow-[0_0_8px_rgba(216,180,254,1)]' : ''}`} color="#d8b4fe" fill={missions.morningHygiene} />
                                            <span className={`text-[9px] font-bold ${missions.morningHygiene ? 'text-purple-300' : 'text-white'}`}>위생</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="relative z-10 space-y-1.5 pl-1">
                                    <div className="flex flex-col">
                                        <span className="text-[11px] font-bold text-purple-100 drop-shadow-md leading-tight">보컬로이드 & 환기</span>
                                        <span className="text-[10px] text-purple-100/90 drop-shadow-sm leading-tight">산책/샤워/독서</span>
                                    </div>
                                </div>
                            </div>

                            {/* AFTERNOON */}
                            <div className="flex-1 w-full relative p-2 flex flex-col border-t border-white/80 overflow-hidden group">
                                <div className="absolute inset-0 bg-sky-300 opacity-[0.25] group-hover:opacity-[0.35] transition-opacity"></div>
                                
                                <div className="relative z-10 flex items-start justify-between mb-0.5">
                                    <div className="flex items-center gap-1.5 mt-0.5">
                                        <IconCloudSun className="w-3.5 h-3.5" color="#7dd3fc" />
                                        <span className="text-[11px] font-bold text-sky-300 tracking-wide uppercase">Afternoon</span>
                                    </div>

                                    {/* Indicators: 식사 -> 산책 -> 독서 */}
                                    <div className="absolute right-0.5 top-0.5 flex flex-col items-end gap-1 z-20">
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.afternoonMeal ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconUtensils className={`w-3 h-3 ${missions.afternoonMeal ? 'drop-shadow-[0_0_8px_rgba(125,211,252,1)]' : ''}`} color="#7dd3fc" fill={missions.afternoonMeal} />
                                            <span className={`text-[9px] font-bold ${missions.afternoonMeal ? 'text-sky-300' : 'text-white'}`}>식사</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.afternoonWalk ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconSparkle className={`w-3 h-3 ${missions.afternoonWalk ? 'drop-shadow-[0_0_8px_rgba(125,211,252,1)]' : ''}`} color="#7dd3fc" fill={missions.afternoonWalk} />
                                            <span className={`text-[9px] font-bold ${missions.afternoonWalk ? 'text-sky-300' : 'text-white'}`}>산책</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.afternoonReading ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconBook className={`w-3 h-3 ${missions.afternoonReading ? 'drop-shadow-[0_0_8px_rgba(125,211,252,1)]' : ''}`} color="#7dd3fc" fill={missions.afternoonReading} />
                                            <span className={`text-[9px] font-bold ${missions.afternoonReading ? 'text-sky-300' : 'text-white'}`}>독서</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="relative z-10 space-y-1.5 pl-1">
                                    <div className="flex flex-col">
                                        <span className="text-[11px] font-bold text-sky-100 drop-shadow-md leading-tight">Rock/Metal</span>
                                        <span className="text-[10px] text-sky-100/90 drop-shadow-sm leading-tight">수업 준비/상담</span>
                                    </div>
                                </div>
                            </div>

                            {/* NIGHT */}
                            <div className="flex-1 w-full relative p-2 flex flex-col border-t border-white/80 overflow-hidden group">
                                <div className="absolute inset-0 bg-yellow-200 opacity-[0.3] group-hover:opacity-[0.4] transition-opacity"></div>
                                
                                <div className="relative z-10 flex items-start justify-between mb-0.5">
                                    <div className="flex items-center gap-1.5">
                                        <IconStar className="w-3.5 h-3.5" color="#fef08a" />
                                        <span className="text-[11px] font-bold text-yellow-200 tracking-wide uppercase">Night</span>
                                    </div>

                                    {/* Indicators: 식사 -> 산책 -> 위생 -> 기록 */}
                                    <div className="absolute right-0.5 top-0.5 flex flex-col items-end gap-1 z-20">
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.nightMeal ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconUtensils className={`w-3 h-3 ${missions.nightMeal ? 'drop-shadow-[0_0_8px_rgba(254,240,138,1)]' : ''}`} color="#fef08a" fill={missions.nightMeal} />
                                            <span className={`text-[9px] font-bold ${missions.nightMeal ? 'text-yellow-200' : 'text-white'}`}>식사</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.nightWalk ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconSparkle className={`w-3 h-3 ${missions.nightWalk ? 'drop-shadow-[0_0_8px_rgba(254,240,138,1)]' : ''}`} color="#fef08a" fill={missions.nightWalk} />
                                            <span className={`text-[9px] font-bold ${missions.nightWalk ? 'text-yellow-200' : 'text-white'}`}>산책</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.nightHygiene ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconDroplets className={`w-3 h-3 ${missions.nightHygiene ? 'drop-shadow-[0_0_8px_rgba(254,240,138,1)]' : ''}`} color="#fef08a" fill={missions.nightHygiene} />
                                            <span className={`text-[9px] font-bold ${missions.nightHygiene ? 'text-yellow-200' : 'text-white'}`}>위생</span>
                                        </div>
                                        <div className={`flex items-center gap-1 transition-all duration-500 ${missions.nightRecord ? 'opacity-100' : 'opacity-20'}`}>
                                            <IconPen className={`w-3 h-3 ${missions.nightRecord ? 'drop-shadow-[0_0_8px_rgba(254,240,138,1)]' : ''}`} color="#fef08a" fill={missions.nightRecord} />
                                            <span className={`text-[9px] font-bold ${missions.nightRecord ? 'text-yellow-200' : 'text-white'}`}>기록</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="relative z-10 space-y-1.5 pl-1">
                                    <div className="flex flex-col">
                                        <span className="text-[11px] font-bold text-yellow-100 drop-shadow-md leading-tight">Jazz & 주황 조명</span>
                                        <span className="text-[10px] text-yellow-100/90 drop-shadow-sm leading-tight">자기돌봄/일기</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* [Footer] Info: Weather & Dust */}
                    <div className="glass-bar border-t-glass h-[36px] flex items-stretch"
                         style={{ backgroundColor: 'rgba(255, 255, 255, 0.05)' }}>
                        
                        <div className="flex-1 flex items-center justify-center border-r-glass gap-1">
                            {getWeatherIcon(weather.code, weatherColor)}
                            {/* pt-0.5 삭제됨 */}
                            <span className="font-mono text-xs font-bold" style={{ color: weatherColor }}>
                                {weather.temp}°
                            </span>
                        </div>
                        
                        <div className="flex-1 flex items-center justify-center gap-1">
                            {getDustIcon(dust.aqi, dustColor)}
                            {/* pt-0.5 삭제됨 */}
                            <span className="font-sans text-[10px] font-bold" style={{ color: dustColor }}>
                                {dust.status}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimelineWidget />);
    </script>
</body>
</html>
