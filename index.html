<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Widget (Dark Mode)</title>
    
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #191919; /* ë…¸ì…˜ ë‹¤í¬ëª¨ë“œ ë°°ê²½ */
            color: #ffffff;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* ì›í˜• íƒ€ì´ë¨¸ ì• ë‹ˆë©”ì´ì…˜ */
        .timer-circle {
            transition: stroke-dashoffset 1s linear;
        }

        /* ì¹´ë“œ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ (CSSë¡œ êµ¬í˜„í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€) */
        .slide-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 24px;
        }

        .card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s ease;
        }

        /* ì¹´ë“œê°€ í™œì„±í™”ë˜ì—ˆì„ ë•Œ */
        .card.active {
            transform: translateY(0) scale(1);
            opacity: 1;
            z-index: 10;
        }

        /* ì¹´ë“œê°€ ëŒ€ê¸° ì¤‘ì¼ ë•Œ (ë’¤ì— ìŒ“ì„) */
        .card.next {
            transform: translateY(15px) scale(0.95);
            opacity: 0.6;
            z-index: 5;
        }

        /* ì¹´ë“œê°€ ì™„ë£Œë˜ì–´ ìœ„ë¡œ ì‚¬ë¼ì§ˆ ë•Œ */
        .card.exit {
            transform: translateY(-100%) scale(0.9);
            opacity: 0;
            z-index: 0;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì•„ì´ì½˜ (SVG ì§ì ‘ ì„ ì–¸ìœ¼ë¡œ ë¡œë”© ì˜¤ë¥˜ ë°©ì§€)
        const IconZap = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const IconArrowUp = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>;
        const IconCoffee = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>;
        const IconCheck = () => <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconRefresh = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;

        // ì„¤ì •ê°’ (ì‹œê°„ ìˆ˜ì •ë¨: 30ì´ˆ í…ŒìŠ¤íŠ¸ìš©)
        const PHASES = {
            START: {
                id: 'start',
                duration: 30,
                // íŒŒìŠ¤í…” ë¸”ë£¨ ê·¸ë¼ë°ì´ì…˜
                bgClass: 'bg-gradient-to-br from-[#BCECEC] to-[#C2BBFF]',
                textClass: 'text-slate-800',
                title: '30s Ignition',
                icon: <IconZap />
            },
            EXTENSION: {
                id: 'extension',
                duration: 30,
                // íŒŒìŠ¤í…” í•‘í¬ ê·¸ë¼ë°ì´ì…˜
                bgClass: 'bg-gradient-to-br from-[#FFD1FF] to-[#FBD0C8]',
                textClass: 'text-slate-800',
                title: 'Extend Focus?',
                icon: <IconArrowUp />
            },
            TRANSITION: {
                id: 'transition',
                duration: 30,
                // íŒŒìŠ¤í…” ë¯¼íŠ¸ ê·¸ë¼ë°ì´ì…˜
                bgClass: 'bg-gradient-to-br from-[#F7CDE1] to-[#97F7F5]',
                textClass: 'text-slate-800',
                title: 'Rest Routine',
                icon: <IconCoffee />
            }
        };

        // ì‚¬ìš´ë“œ ì„¤ì • (ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬)
        const playSound = (type) => {
            try {
                const src = type === 'click' 
                    ? 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3' 
                    : 'https://assets.mixkit.co/active_storage/sfx/1003/1003-preview.mp3';
                const audio = new Audio(src);
                audio.volume = 0.4;
                audio.play().catch(e => console.log('Audio blocked (interaction needed first)'));
            } catch (e) {
                console.error('Sound error', e);
            }
        };

        const FocusWidget = () => {
            const [currentPhase, setCurrentPhase] = useState('start');
            const [timeLeft, setTimeLeft] = useState(PHASES.START.duration);
            const [isActive, setIsActive] = useState(false);
            const [showExtensionChoice, setShowExtensionChoice] = useState(false);
            const [isFinished, setIsFinished] = useState(false);

            // íƒ€ì´ë¨¸ ë¡œì§
            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft((t) => t - 1);
                    }, 1000);
                } else if (timeLeft === 0 && isActive) {
                    setIsActive(false);
                    playSound('fanfare');
                    handlePhaseComplete();
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft]);

            const handlePhaseComplete = () => {
                if (currentPhase === 'start') {
                    setShowExtensionChoice(true);
                } else if (currentPhase === 'extension') {
                    startPhase('transition');
                } else if (currentPhase === 'transition') {
                    setIsFinished(true);
                }
            };

            const startPhase = (phaseKey) => {
                setCurrentPhase(phaseKey);
                setTimeLeft(PHASES[phaseKey.toUpperCase()].duration);
                setIsActive(true);
                setShowExtensionChoice(false);
                playSound('click');
            };

            const resetAll = () => {
                setCurrentPhase('start');
                setTimeLeft(PHASES.START.duration);
                setIsActive(false);
                setIsFinished(false);
                setShowExtensionChoice(false);
                playSound('click');
            };

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            };

            // ì›í˜• íƒ€ì´ë¨¸ ê³„ì‚°
            const radius = 36;
            const circumference = 2 * Math.PI * radius;
            const maxDuration = PHASES[currentPhase.toUpperCase()].duration;
            const progress = timeLeft / maxDuration;
            const dashoffset = circumference * (1 - progress);

            // ì¹´ë“œ ë Œë”ë§ í—¬í¼ í•¨ìˆ˜
            const renderCard = (phaseKey) => {
                const data = PHASES[phaseKey.toUpperCase()];
                
                // í˜„ì¬ ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ê²°ì •
                let cardStatus = 'next'; // ê¸°ë³¸: ë’¤ì— ìˆìŒ
                if (isFinished) cardStatus = 'exit';
                else if (currentPhase === phaseKey) cardStatus = 'active';
                else if (currentPhase === 'start' && phaseKey === 'extension') cardStatus = 'next';
                else if (currentPhase === 'extension' && phaseKey === 'transition') cardStatus = 'next';
                else cardStatus = 'exit'; // ì´ë¯¸ ì§€ë‚œ ë‹¨ê³„

                // ì‹œê°ì  ìŠ¤íƒ€ì¼ë§
                return (
                    <div key={phaseKey} className={`card p-6 rounded-3xl shadow-xl flex flex-col justify-between ${data.bgClass} ${data.textClass} ${cardStatus}`}>
                        {/* ìƒë‹¨ í—¤ë” */}
                        <div className="flex items-center justify-between opacity-80">
                            <span className="text-xs font-bold tracking-widest uppercase">
                                {phaseKey}
                            </span>
                            {data.icon}
                        </div>

                        {/* ì¤‘ì•™: ì›í˜• íƒ€ì´ë¨¸ + ì‹œê°„ í…ìŠ¤íŠ¸ (ê°€ë¡œ ë°°ì¹˜) */}
                        <div className="flex items-center justify-center gap-5">
                            {/* ì›í˜• ê·¸ë˜í”„ */}
                            <div className="relative w-20 h-20 flex-shrink-0">
                                <svg className="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle className="text-white opacity-30" strokeWidth="8" stroke="currentColor" fill="transparent" r={radius} cx="50" cy="50" />
                                    <circle 
                                        className="text-white timer-circle" 
                                        strokeWidth="8" 
                                        strokeDasharray={circumference} 
                                        strokeDashoffset={dashoffset} 
                                        strokeLinecap="round" 
                                        stroke="currentColor" 
                                        fill="transparent" 
                                        r={radius} 
                                        cx="50" 
                                        cy="50" 
                                    />
                                </svg>
                            </div>
                            
                            {/* í…ìŠ¤íŠ¸ */}
                            <div className="flex flex-col">
                                <span className="text-5xl font-bold tracking-tighter leading-none">
                                    {formatTime(timeLeft)}
                                </span>
                                <span className="text-sm font-semibold opacity-90 mt-1">
                                    {data.title}
                                </span>
                            </div>
                        </div>

                        {/* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */}
                        <div className="mt-2">
                            {!showExtensionChoice ? (
                                phaseKey === 'transition' ? (
                                    <div className="space-y-1 text-sm font-semibold">
                                        <div className="flex items-center gap-2 opacity-80">ğŸ’§ Water</div>
                                        <div className="flex items-center gap-2 opacity-80">ğŸ§˜ Stretch</div>
                                        <button onClick={() => setIsFinished(true)} className="w-full mt-2 bg-black/10 hover:bg-black/20 py-2 rounded-xl transition-colors text-xs uppercase tracking-wide">
                                            Done Early
                                        </button>
                                    </div>
                                ) : (
                                    <button 
                                        onClick={() => { setIsActive(!isActive); playSound('click'); }}
                                        className="w-full py-3 bg-slate-900 text-sky-300 hover:bg-slate-800 rounded-2xl text-lg font-bold shadow-md transition-all active:scale-95 flex items-center justify-center gap-2"
                                    >
                                        {isActive ? "Pause" : "Start Focus"}
                                    </button>
                                )
                            ) : (
                                // ì„ íƒì§€ í™”ë©´
                                <div className="flex flex-col gap-2">
                                    <button onClick={() => startPhase('extension')} className="w-full py-3 bg-blue-600 text-white hover:bg-blue-500 rounded-xl font-bold shadow-md transition-all active:scale-95 flex items-center justify-center gap-2">
                                        <IconArrowUp /> Extend +30s
                                    </button>
                                    <button onClick={() => startPhase('transition')} className="w-full py-2 bg-black/10 hover:bg-black/20 text-slate-900 rounded-xl font-semibold text-sm transition-colors">
                                        Skip to Rest
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="relative w-96 h-[400px] bg-[#191919] p-4 flex items-center justify-center">
                    
                    {/* ì¹´ë“œë“¤ì´ ë“¤ì–´ê°ˆ ì»¨í…Œì´ë„ˆ */}
                    <div className="slide-container bg-[#252525] rounded-3xl shadow-2xl relative w-full h-full max-w-sm max-h-[400px]">
                        
                        {!isFinished ? (
                            <>
                                {renderCard('transition')}
                                {renderCard('extension')}
                                {renderCard('start')}
                            </>
                        ) : (
                            // ì™„ë£Œ í™”ë©´
                            <div className="w-full h-full bg-slate-800 rounded-3xl flex flex-col items-center justify-center text-white animate-fade-in p-6">
                                <div className="w-20 h-20 bg-slate-700 rounded-full flex items-center justify-center mb-6 text-green-400 shadow-inner">
                                    <IconCheck />
                                </div>
                                <h2 className="text-2xl font-bold mb-2">Session Complete</h2>
                                <p className="text-slate-400 text-sm mb-8 text-center">Great focus. You're ready to go again.</p>
                                <button onClick={resetAll} className="flex items-center gap-2 px-8 py-3 bg-sky-500 hover:bg-sky-400 text-white rounded-full font-bold shadow-lg transition-all active:scale-95">
                                    <IconRefresh /> Reset
                                </button>
                            </div>
                        )}
                        
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FocusWidget />);
    </script>
</body>
</html>
