<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact Focus Widget</title>
    
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #191919; /* ë…¸ì…˜ ë‹¤í¬ëª¨ë“œ ë°°ê²½ */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        /* ìˆ«ì í”ë“¤ë¦¼ ë°©ì§€ (ê³ ì •í­) */
        .tabular-nums {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        /* ì›í˜• íƒ€ì´ë¨¸ ë¶€ë“œëŸ¬ìš´ ì „í™˜ */
        .timer-circle {
            transition: stroke-dashoffset 1s linear;
        }

        /* ì¹´ë“œ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ (ì¢Œìš°) */
        .card-container {
            position: relative;
            width: 360px;
            height: 220px; /* ë†’ì´ ì»´íŒ©íŠ¸í•˜ê²Œ ê³ ì • */
        }

        .card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 24px;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        /* í˜„ì¬ í™œì„± ì¹´ë“œ */
        .card.active {
            z-index: 20;
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        /* ë’¤ì— ëŒ€ê¸° ì¤‘ì¸ ì¹´ë“œ (ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚´ì§ ë¹¼ê¼¼) */
        .card.next {
            z-index: 10;
            transform: translateX(12px) scale(0.95); /* ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚´ì§ ì´ë™ */
            opacity: 0.6;
            filter: brightness(0.7); /* ë’¤ì— ìˆëŠ” ëŠë‚Œ */
        }

        /* ì™¼ìª½ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .card.slide-out-left {
            transform: translateX(-120%) scale(0.9);
            opacity: 0;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì•„ì´ì½˜
        const IconZap = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const IconArrowUp = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>;
        const IconCoffee = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4 4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>;
        const IconCheck = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconRefresh = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;

        // ì„¤ì •ê°’ (ì‹œê°„ì€ 30ì´ˆ í…ŒìŠ¤íŠ¸ìš© ìœ ì§€)
        const PHASES = {
            START: {
                id: 'start',
                duration: 30,
                bgClass: 'bg-gradient-to-br from-[#E0EAFF] to-[#C9B8FF]', // ë¼ë²¤ë”/ë¸”ë£¨ íŒŒìŠ¤í…”
                textClass: 'text-slate-800',
                title: 'Focus',
                icon: <IconZap />
            },
            EXTENSION: {
                id: 'extension',
                duration: 30,
                bgClass: 'bg-gradient-to-br from-[#FFEEEF] to-[#FBCfe8]', // í•‘í¬ íŒŒìŠ¤í…”
                textClass: 'text-slate-800',
                title: 'Extend?',
                icon: <IconArrowUp />
            },
            TRANSITION: {
                id: 'transition',
                duration: 30,
                bgClass: 'bg-gradient-to-br from-[#E0F2F1] to-[#80DEEA]', // ë¯¼íŠ¸ íŒŒìŠ¤í…”
                textClass: 'text-slate-800',
                title: 'Rest',
                icon: <IconCoffee />
            }
        };

        const playSound = (type) => {
            try {
                // í´ë¦­: ë¬¼ë°©ìš¸ / ì¢…ë£Œ: ë§‘ì€ ë”©~ ì†Œë¦¬
                const src = type === 'click' 
                    ? 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3' 
                    : 'https://assets.mixkit.co/active_storage/sfx/1118/1118-preview.mp3'; // Soft Notification Chime
                const audio = new Audio(src);
                audio.volume = type === 'click' ? 0.4 : 0.3;
                audio.play().catch(() => {});
            } catch (e) {}
        };

        const FocusWidget = () => {
            const [currentPhase, setCurrentPhase] = useState('start');
            const [timeLeft, setTimeLeft] = useState(PHASES.START.duration);
            const [isActive, setIsActive] = useState(false);
            const [showExtensionChoice, setShowExtensionChoice] = useState(false);
            const [isFinished, setIsFinished] = useState(false);
            const [exitingPhase, setExitingPhase] = useState(null); // ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ìš©

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft((t) => t - 1);
                    }, 1000);
                } else if (timeLeft === 0 && isActive) {
                    setIsActive(false);
                    playSound('finish');
                    handlePhaseComplete();
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft]);

            const handlePhaseComplete = () => {
                if (currentPhase === 'start') {
                    setShowExtensionChoice(true);
                } else if (currentPhase === 'extension') {
                    animateTransition('transition');
                } else if (currentPhase === 'transition') {
                    setIsFinished(true);
                }
            };

            // ì¢Œìš° ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ í•¨ìˆ˜
            const animateTransition = (nextPhaseKey) => {
                setExitingPhase(currentPhase); // í˜„ì¬ ë‹¨ê³„ë¥¼ 'ë‚˜ê°€ëŠ” ìƒíƒœ'ë¡œ ì„¤ì •
                
                // 0.5ì´ˆ ë’¤ì— ì‹¤ì œ ë°ì´í„° ë³€ê²½ (CSS ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ë§ì¶¤)
                setTimeout(() => {
                    setCurrentPhase(nextPhaseKey);
                    setTimeLeft(PHASES[nextPhaseKey.toUpperCase()].duration);
                    setIsActive(true);
                    setShowExtensionChoice(false);
                    setExitingPhase(null);
                    playSound('click');
                }, 400);
            };

            const resetAll = () => {
                setCurrentPhase('start');
                setTimeLeft(PHASES.START.duration);
                setIsActive(false);
                setIsFinished(false);
                setShowExtensionChoice(false);
                playSound('click');
            };

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            };

            const radius = 28; // ì› í¬ê¸° ì¶•ì†Œ (ì»´íŒ©íŠ¸)
            const circumference = 2 * Math.PI * radius;
            const maxDuration = PHASES[currentPhase.toUpperCase()].duration;
            const progress = timeLeft / maxDuration;
            const dashoffset = circumference * (1 - progress);

            // ì¹´ë“œ ë Œë”ë§
            const renderCard = (phaseKey) => {
                const data = PHASES[phaseKey.toUpperCase()];
                
                // í´ë˜ìŠ¤ ê³„ì‚°: Active, Next(Stack), Exiting(Slide)
                let statusClass = '';
                
                if (exitingPhase === phaseKey) {
                    statusClass = 'active slide-out-left'; // í˜„ì¬ ë‚˜ê°€ê³  ìˆëŠ” ì¹´ë“œ
                } else if (currentPhase === phaseKey && !exitingPhase) {
                    statusClass = 'active'; // í˜„ì¬ í™œì„± ì¹´ë“œ
                } else {
                    // ìˆœì„œìƒ ë°”ë¡œ ë‹¤ìŒ ì¹´ë“œì¸ì§€ í™•ì¸
                    const order = ['start', 'extension', 'transition'];
                    const currentIndex = order.indexOf(currentPhase);
                    const phaseIndex = order.indexOf(phaseKey);
                    
                    if (phaseIndex === currentIndex + 1) {
                        statusClass = 'next'; // ë°”ë¡œ ë’¤ì— ê²¹ì³ìˆëŠ” ì¹´ë“œ
                    } else {
                        return null; // ê·¸ ì™¸ ì¹´ë“œëŠ” ë Œë”ë§ ì•ˆ í•¨
                    }
                }

                return (
                    <div key={phaseKey} className={`card p-5 flex flex-row items-center justify-between ${data.bgClass} ${data.textClass} ${statusClass}`}>
                        
                        {/* ì™¼ìª½: ì›í˜• íƒ€ì´ë¨¸ */}
                        <div className="relative w-16 h-16 flex-shrink-0 mr-4">
                            <svg className="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                <circle className="text-white opacity-40" strokeWidth="8" stroke="currentColor" fill="transparent" r={radius} cx="50" cy="50" />
                                <circle 
                                    className="text-white timer-circle" 
                                    strokeWidth="8" 
                                    strokeDasharray={circumference} 
                                    strokeDashoffset={dashoffset} 
                                    strokeLinecap="round" 
                                    stroke="currentColor" 
                                    fill="transparent" 
                                    r={radius} 
                                    cx="50" 
                                    cy="50" 
                                />
                            </svg>
                        </div>

                        {/* ì˜¤ë¥¸ìª½: ì»¨í…ì¸  ì˜ì—­ */}
                        <div className="flex-1 flex flex-col justify-center h-full">
                            <div className="flex justify-between items-center mb-1 opacity-80">
                                <span className="text-xs font-bold uppercase tracking-wider">{data.title}</span>
                                {data.icon}
                            </div>
                            
                            {/* ê³ ì •í­ ìˆ«ì ì ìš© (tabular-nums) */}
                            <div className="text-4xl font-bold tracking-tight leading-none tabular-nums mb-3">
                                {formatTime(timeLeft)}
                            </div>

                            {/* ë²„íŠ¼ ì˜ì—­ */}
                            <div className="w-full">
                                {!showExtensionChoice ? (
                                    phaseKey === 'transition' ? (
                                        <div className="flex gap-2">
                                            <div className="text-xs font-semibold opacity-70 flex items-center gap-1">ğŸ’§Water</div>
                                            <div className="text-xs font-semibold opacity-70 flex items-center gap-1">ğŸ§˜Stretch</div>
                                            <button onClick={() => setIsFinished(true)} className="ml-auto px-3 py-1.5 bg-black/10 hover:bg-black/20 rounded-lg text-xs font-bold transition-colors">
                                                Done
                                            </button>
                                        </div>
                                    ) : (
                                        <button 
                                            onClick={() => { setIsActive(!isActive); playSound('click'); }}
                                            className="w-full py-2 bg-slate-900 text-sky-200 hover:bg-slate-800 rounded-xl text-sm font-bold shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2"
                                        >
                                            {isActive ? "Pause" : "Start"}
                                        </button>
                                    )
                                ) : (
                                    <div className="flex gap-2">
                                        <button onClick={() => animateTransition('extension')} className="flex-1 py-2 bg-blue-600 text-white hover:bg-blue-500 rounded-xl text-sm font-bold shadow-sm transition-all active:scale-95">
                                            +30s
                                        </button>
                                        <button onClick={() => animateTransition('transition')} className="px-3 py-2 bg-slate-800/10 hover:bg-slate-800/20 text-slate-800 rounded-xl text-xs font-bold transition-colors">
                                            Skip
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="card-container">
                    {!isFinished ? (
                        <>
                            {/* ë Œë”ë§ ìˆœì„œ ì¤‘ìš”: ë’¤ì— ìˆëŠ” ê²ƒë¶€í„° */}
                            {renderCard('transition')}
                            {renderCard('extension')}
                            {renderCard('start')}
                        </>
                    ) : (
                        // ì™„ë£Œ ì¹´ë“œ
                        <div className="card active bg-slate-800 p-6 flex flex-col items-center justify-center text-white">
                            <div className="w-12 h-12 bg-slate-700 rounded-full flex items-center justify-center mb-3 text-green-400">
                                <IconCheck />
                            </div>
                            <h2 className="text-lg font-bold mb-1">Session Done</h2>
                            <p className="text-slate-400 text-xs mb-5">Ready for next?</p>
                            <button onClick={resetAll} className="flex items-center gap-2 px-6 py-2 bg-sky-600 hover:bg-sky-500 text-white rounded-full text-sm font-bold shadow-md transition-all active:scale-95">
                                <IconRefresh /> Reset
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FocusWidget />);
    </script>
</body>
</html>
