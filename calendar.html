<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortress Calendar</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Playfair+Display:wght@400;600;700&family=Roboto+Mono:wght@400;500;700&display=swap');

        /* 기본 설정 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: transparent;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* 스크롤바 숨김 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* [핵심] Fortress Glass 컨테이너 */
        .widget-container {
            position: relative;
            width: 100%;
            max-width: 260px; /* 캘린더 표준 너비 */
            height: 540px;
            /* 배경: 은은한 Icy Blue 그라디언트 + 블러 */
            background: linear-gradient(180deg, rgba(224, 242, 254, 0.25) 0%, rgba(240, 249, 255, 0.15) 100%);
            backdrop-filter: blur(25px);
            border-radius: 28px;
            border: 1px solid rgba(224, 242, 254, 0.4);
            box-shadow: 0 8px 32px rgba(186, 230, 253, 0.15), inset 0 0 20px rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #334155;
        }

        /* 타이포그래피 */
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-mono { font-family: 'Roboto Mono', monospace; }

        /* 캘린더 그리드 스타일 */
        .calendar-fixed-height {
            min-height: 260px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            text-align: center;
        }
        
        /* 날짜 셀 디자인 */
        .day-cell {
            height: 36px;
            display: flex;
            flex-direction: column; 
            justify-content: flex-start;
            align-items: center;
            border-radius: 8px;
            font-size: 0.75rem; /* 12px */
            font-family: 'Roboto Mono', monospace;
            position: relative;
            cursor: pointer;
            padding-top: 4px;
            transition: all 0.2s ease;
            color: rgba(51, 65, 85, 0.8); /* Slate 700 */
        }
        .day-cell:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
        .day-cell-empty { pointer-events: none; }

        /* 오늘 날짜 강조 */
        .day-today {
            background: rgba(255, 255, 255, 0.3) !important;
            border: 1px solid rgba(186, 230, 253, 0.8);
            box-shadow: 0 0 15px rgba(186, 230, 253, 0.4);
            font-weight: 700;
            color: #0ea5e9 !important; /* Sky 500 */
        }

        /* 선택된 날짜 */
        .day-selected {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 일정 도트(점) 스타일 */
        .dot-wrapper { margin-top: 2px; flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .dot-plus-container { display: flex; align-items: center; gap: 1px; }
        .dot { width: 4px; height: 4px; border-radius: 50%; }

        /* 상태별 컬러 (Tailwind 호환) */
        .bg-work { background-color: #38bdf8; box-shadow: 0 0 4px rgba(56, 189, 248, 0.6); }   
        .bg-dev { background-color: #c084fc; box-shadow: 0 0 4px rgba(192, 132, 252, 0.6); }    
        .bg-health { background-color: #fde047; box-shadow: 0 0 4px rgba(253, 224, 71, 0.6); } 
        .bg-rest { background-color: #cbd5e1; }                                                 

        /* 텍스트 컬러 */
        .text-rose-custom { color: #fb7185; } /* Rose 400 */
        .text-blue-custom { color: #60a5fa; } /* Blue 400 */
        .text-dim { color: #94a3b8; }
        .text-sky-point { color: #0ea5e9; text-shadow: 0 0 10px rgba(186, 230, 253, 0.5); }

        /* 하단 일정 리스트 카드 */
        .event-card {
            background: rgba(255, 255, 255, 0.1); /* 더 투명하게 */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            transition: all 0.2s ease; 
            margin-bottom: 4px;
        }
        .event-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(2px);
        }
        .event-past { opacity: 0.5; filter: grayscale(0.8); border-style: dashed; background: transparent; }

        /* 네비게이션 버튼 */
        .nav-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 6px; color: rgba(51, 65, 85, 0.6); transition: all 0.2s; }
        .nav-btn:hover { color: #0ea5e9; background: rgba(255,255,255,0.3); }
        
        .list-nav-btn { width: 100%; height: 20px; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 10px; transition: all 0.2s; cursor: pointer; border-radius: 8px; }
        .list-nav-btn:hover { color: #38bdf8; background: rgba(255,255,255,0.1); }
        .list-nav-btn:disabled { opacity: 0; cursor: default; }

    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sky: { 200: '#bae6fd', 300: '#7dd3fc', 500: '#0ea5e9' },
                        purple: { 200: '#e9d5ff', 300: '#d8b4fe' },
                        slate: { 400: '#94a3b8', 700: '#334155' }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif'],
                        mono: ['"Roboto Mono"', 'monospace'],
                    }
                }
            }
        }
    </script>
<style>
        /* 1. 위젯 전체 배경을 아주 투명하게 변경 (안료 농도 25% -> 5%) */
        .widget-container {
            background: linear-gradient(180deg, rgba(224, 242, 254, 0.05) 0%, rgba(240, 249, 255, 0.02) 100%) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important; /* 테두리도 얇게 */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3) !important; /* 그림자는 어둡게 */
        }

        /* 2. 내부 박스(헤더, 카드 등)들도 투명하게 */
        .header-section, 
        .glass-panel, 
        .event-card, 
        .todo-item:hover,
        .quest-btn {
            background: rgba(255, 255, 255, 0.03) !important;
            border-color: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(10px);
        }

        /* 3. 글씨가 배경에 묻히지 않게 더 밝게 조정 */
        body { color: #f1f5f9 !important; } /* 기본 글씨: 밝은 회색 */
        .text-slate-700 { color: #e2e8f0 !important; } /* 진한 글씨 -> 밝게 */
        .text-slate-600 { color: #cbd5e1 !important; }
        .text-slate-500 { color: #94a3b8 !important; }
        
        /* 4. 입력창도 투명하게 */
        input, select, .custom-select {
            background: rgba(255, 255, 255, 0.05) !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
            color: #fff !important;
        }
        
        /* 5. 투두리스트 완료 항목 더 어둡게 처리 */
        .todo-done { opacity: 0.3 !important; }
    </style>
    </head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const WORKER_BASE_URL = "https://log-cal.moonkelly601.workers.dev";
        
        const CALENDARS = {
            holiday: "https://calendar.google.com/calendar/ical/ko.south_korea%23holiday%40group.v.calendar.google.com/public/basic.ics", 
            red: "https://p151-caldav.icloud.com/published/2/MjAxNzA0NzQzNTEyMDE3MBESdZX6cJss130QKAIlxInlf0nwQRwqVQaKN3oFgWzqLUfigKhteMNDAjQwkPlHzBe_ELV5RYcePFbCOI5H3TM",    
            orange: "https://p151-caldav.icloud.com/published/2/MjAxNzA0NzQzNTEyMDE3MBESdZX6cJss130QKAIlxIlkFT1ZEqbRVczq6PrGuVHb0Afa1EhpfGiSULTpK_tYur-eQz2Uqc74JIqfAKkjBP8", 
            blue: "https://p151-caldav.icloud.com/published/2/MjAxNzA0NzQzNTEyMDE3MBESdZX6cJss130QKAIlxImfGB8G7hln8RI2A4WFBMN51g9wFHOsIhQgRFNSx9Dz4_f4s6w0S4RBWQw9Fgtt2mU",   
            green: "https://p151-caldav.icloud.com/published/2/MjAxNzA0NzQzNTEyMDE3MBESdZX6cJss130QKAIlxIks_Phe4DHFMcJQdGTXVekoe7DfsUtHGLCLydgauhnycV_BUoW1c_GcPu0dMkd_m9I"    
        };

        const COLOR_MAP = { 
            orange: 'bg-health',
            blue:   'bg-dev',
            red:    'bg-work',
            green:  'bg-rest'
        };

        const Icons = {
            ChevronLeft: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M15 18l-6-6 6-6"/></svg>,
            ChevronRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18l6-6-6-6"/></svg>,
            RotateCcw: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>,
            ArrowUp: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>,
            ArrowDown: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>,
            Flame: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3a7 7 0 0 0 3 3.3z"></path></svg>,
            Book: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>,
            Pen: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l5.5 5.5"></path><path d="M11 11l5.5 5.5"></path></svg>,
        };

        const safeParseDate = (dateStr) => {
            if (!dateStr || typeof dateStr !== 'string') return null;
            try {
                const isUTC = dateStr.endsWith('Z');
                const cleanStr = dateStr.replace('Z', '');
                const year = parseInt(cleanStr.substring(0, 4));
                const month = parseInt(cleanStr.substring(4, 6)) - 1;
                const day = parseInt(cleanStr.substring(6, 8));
                let hour = 0, min = 0;
                if (cleanStr.includes('T')) {
                    const timePart = cleanStr.split('T')[1];
                    if (timePart.length >= 4) {
                        hour = parseInt(timePart.substring(0, 2));
                        min = parseInt(timePart.substring(2, 4));
                    }
                }
                if (isUTC) return new Date(Date.UTC(year, month, day, hour, min));
                const d = new Date(year, month, day, hour, min);
                if (isNaN(d.getTime())) return null;
                return d;
            } catch (e) { return null; }
        };

        const App = () => {
            const [currentDate, setCurrentDate] = useState(new Date()); 
            const [selectedDate, setSelectedDate] = useState(new Date()); 
            const [events, setEvents] = useState({}); 
            const [visibleRange, setVisibleRange] = useState({ start: 0, end: 3 });
            const [debugMsg, setDebugMsg] = useState("Loading...");
            const [holidaySet, setHolidaySet] = useState(new Set());
            const [historyMap, setHistoryMap] = useState({});
            const [monthlyStats, setMonthlyStats] = useState({ exercise: 0, reading: 0, record: 0 });

            useEffect(() => {
                const loadHistory = () => {
                const history = JSON.parse(localStorage.getItem('fortressHistory') || '[]');
                const todayData = JSON.parse(localStorage.getItem('fortressData') || '{}');
                
                const allData = [...history];
                if (todayData.date) allData.push(todayData);

                const map = {};
                let exCnt = 0, rdCnt = 0, rcCnt = 0;
                let monthTotalMin = 0; // 총 시간 합산 변수 추가
                let validDays = 0;

                const thisMonthPrefix = `${year}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;

                allData.forEach(day => {
                    const focusBlocks = (day.blocks || []).filter(b => b.type === 'focus' || !b.type);
                    const totalMin = focusBlocks.reduce((acc, cur) => acc + (cur.duration || 0), 0);
                    
                    const d = new Date(day.date);
                    const dateKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                    map[dateKey] = totalMin;

                    if (dateKey.startsWith(thisMonthPrefix)) {
                        const blocks = day.blocks || [];
                        if (blocks.some(b => b.name === '운동')) exCnt++;
                        if (blocks.some(b => b.name === '독서')) rdCnt++;
                        if (blocks.some(b => b.name === '기록')) rcCnt++;
                        monthTotalMin += totalMin; // 이번 달 시간 누적
                        validDays++; 
                    }
                });

                setHistoryMap(map);
                
                const calcPct = (cnt) => validDays === 0 ? 0 : Math.round((cnt / validDays) * 100);
                // 평균 시간 계산 (분 단위)
                const avgTime = validDays === 0 ? 0 : Math.round(monthTotalMin / validDays);

                setMonthlyStats({ 
                    exercise: calcPct(exCnt), 
                    reading: calcPct(rdCnt), 
                    record: calcPct(rcCnt),
                    average: avgTime // 상태 추가
                });
            };

                loadHistory();
                window.addEventListener('storage', loadHistory);
                return () => window.removeEventListener('storage', loadHistory);
            }, [currentDate, year]);

            const isSameDay = (d1, d2) => d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
            
            const isHoliday = (year, month, day) => {
                const key = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                return holidaySet.has(key);
            };

            const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
            const goToday = () => { const now = new Date(); setCurrentDate(now); setSelectedDate(now); };

            const year = currentDate.getFullYear();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const monthStr = monthNames[currentDate.getMonth()];

            const fetchAllCalendars = async () => {
                setDebugMsg("Fetching Data...");
                let newEvents = {};
                let tempHolidays = new Set(); 
                let successCount = 0;
                const timeoutPromise = new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 15000));
                try {
                    for (const [colorKey, url] of Object.entries(CALENDARS)) {
                        try {
                            const fetchPromise = fetch(`${WORKER_BASE_URL}?url=${encodeURIComponent(url)}`);
                            const response = await Promise.race([fetchPromise, timeoutPromise]);
                            if (!response.ok) throw new Error('Net Error');
                            const text = await response.text();
                            const lines = text.split("\n");
                            let event = {};
                            
                            for (const line of lines) {
                                const cleanLine = line.trim();
                                if (cleanLine.startsWith("BEGIN:VEVENT")) event = {};
                                else if (cleanLine.startsWith("DTSTART")) event.start = cleanLine.split(":")[1];
                                else if (cleanLine.startsWith("DTEND")) event.end = cleanLine.split(":")[1];
                                else if (cleanLine.startsWith("SUMMARY")) {
                                    let rawTitle = cleanLine.substring(cleanLine.indexOf(':') + 1);
                                    event.title = rawTitle.replace(/\\,/g, ',').replace(/\\;/g, ';').replace(/\\\\/g, '\\').trim();
                                }
                                else if (cleanLine.startsWith("END:VEVENT")) {
                                    if (event.start) {
                                        const startDateObj = safeParseDate(event.start);
                                        
                                        if (startDateObj) {
                                            if (colorKey === 'holiday') {
                                                const holStr = `${startDateObj.getFullYear()}-${String(startDateObj.getMonth()+1).padStart(2,'0')}-${String(startDateObj.getDate()).padStart(2,'0')}`;
                                                tempHolidays.add(holStr);
                                                continue; 
                                            }

                                            let endDateObj = event.end ? safeParseDate(event.end) : null;
                                            if (!endDateObj && startDateObj) endDateObj = new Date(startDateObj.getTime() + 60*60*1000);

                                            const dateKey = `${startDateObj.getFullYear()}${String(startDateObj.getMonth()+1).padStart(2,'0')}${String(startDateObj.getDate()).padStart(2,'0')}`;
                                            const formatTime = (date) => `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                                            
                                            const eventObj = {
                                                title: event.title || "No Title",
                                                type: COLOR_MAP[colorKey],
                                                startTime: formatTime(startDateObj),
                                                endTime: endDateObj ? formatTime(endDateObj) : "00:00",
                                                dateObj: startDateObj
                                            };
                                            if (!newEvents[dateKey]) newEvents[dateKey] = [];
                                            newEvents[dateKey].push(eventObj);
                                        }
                                    }
                                }
                            }
                            successCount++;
                        } catch (e) { console.warn(`Skip ${colorKey}`); }
                    }
                    if (successCount > 0) {
                        for (const key in newEvents) newEvents[key].sort((a, b) => a.dateObj - b.dateObj);
                        setEvents(newEvents);
                        setHolidaySet(tempHolidays); 
                        setDebugMsg(""); 
                    } else { throw new Error("All Failed"); }
                } catch (err) {
                    setDebugMsg("Connection Failed.");
                }
            };

            useEffect(() => {
                fetchAllCalendars();
            }, []);

            const currentDayEvents = useMemo(() => {
                const key = `${selectedDate.getFullYear()}${String(selectedDate.getMonth()+1).padStart(2,'0')}${String(selectedDate.getDate()).padStart(2,'0')}`;
                return events[key] || [];
            }, [events, selectedDate]);

            const isEventPast = (evt, date) => {
                const now = new Date();
                if (!isSameDay(date, now)) return date < new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const [startH, startM] = evt.startTime.split(':').map(Number);
                const [endH, endM] = evt.endTime.split(':').map(Number);
                let evtEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), endH, endM);
                if (endH < startH || (endH === startH && endM < startM)) evtEnd.setDate(evtEnd.getDate() + 1);
                return now > evtEnd;
            };

            useEffect(() => {
                if (currentDayEvents.length === 0) { setVisibleRange({ start: 0, end: 0 }); return; }
                const firstFutureIndex = currentDayEvents.findIndex(evt => !isEventPast(evt, selectedDate));
                let startIndex = firstFutureIndex === -1 ? Math.max(0, currentDayEvents.length - 3) : firstFutureIndex;
                setVisibleRange({ start: startIndex, end: Math.min(currentDayEvents.length, startIndex + 3) });
            }, [currentDayEvents, selectedDate]);

            const visibleEvents = currentDayEvents.slice(visibleRange.start, visibleRange.end);
            const handleLoadPrev = () => setVisibleRange(prev => ({ start: Math.max(0, prev.start - 3), end: prev.end }));
            const handleLoadNext = () => setVisibleRange(prev => ({ start: prev.start, end: Math.min(currentDayEvents.length, prev.end + 3) }));

            const getEventTypes = (day) => {
                const key = `${year}${String(currentDate.getMonth()+1).padStart(2,'0')}${String(day).padStart(2,'0')}`;
                return events[key] || [];
            };
            const getDayColor = (dayIdx, isHol) => {
                if (isHol || dayIdx === 0) return 'text-rose-custom'; 
                if (dayIdx === 6) return 'text-blue-custom'; 
                return 'text-dim';
            };

            const firstDayOfMonth = new Date(year, currentDate.getMonth(), 1);
            const daysInMonth = new Date(year, currentDate.getMonth() + 1, 0).getDate();
            const startDay = firstDayOfMonth.getDay(); 

            return (
                <div className="widget-container">
                    {/* Header */}
                    <div className="px-5 pt-5 pb-3 flex justify-between items-end border-b border-white/20 bg-white/15 backdrop-blur-sm z-10 shrink-0">
                        <div>
                            <div className="text-sky-point text-sm font-bold tracking-widest uppercase mb-0.5">
                             {year}
                            </div>
                            <h1 className="text-xl title-text font-serif tracking-tight text-white font-bold">{monthStr}</h1>
                        </div>
                        <div className="flex gap-1 items-center pb-0.5">
                            <button onClick={goToday} className="nav-btn mr-1" title="Go Today"><Icons.RotateCcw /></button>
                            <button onClick={prevMonth} className="nav-btn"><Icons.ChevronLeft /></button>
                            <button onClick={nextMonth} className="nav-btn"><Icons.ChevronRight /></button>
                        </div>
                    </div>

                    <div className="flex-1 px-4 pt-1 pb-0 relative overflow-hidden flex flex-col justify-between">
                        <div className="mb-0 shrink-0 calendar-fixed-height mt-2">
                            <div className="calendar-grid mb-1">
                                {['S','M','T','W','T','F','S'].map((d, i) => (
                                    <div key={i} className={`text-[10px] font-bold ${i === 0 ? 'text-rose-custom' : (i === 6 ? 'text-blue-custom' : 'text-dim')}`}>{d}</div>
                                ))}
                            </div>
                            <div className="calendar-grid">
                                {Array.from({length: 42}).map((_, i) => {
                                    const dayNumber = i - startDay + 1;
                                    const isValidDay = dayNumber > 0 && dayNumber <= daysInMonth;
                                    
                                    if (!isValidDay) return <div key={i} className="day-cell day-cell-empty"></div>;

                                    const day = dayNumber;
                                    const thisDate = new Date(year, currentDate.getMonth(), day);
                                    const isToday = isSameDay(thisDate, new Date());
                                    const isSelected = isSameDay(thisDate, selectedDate);
                                    const dayEvents = getEventTypes(day);
                                    const isHol = isHoliday(year, currentDate.getMonth(), day);
                                    const dayOfWeek = i % 7; 
                                    
                                    let numColor = getDayColor(dayOfWeek, isHol);
                                    if (isToday) numColor = 'text-white font-extrabold';
                                    else if (isSelected) numColor = 'text-white';

                                    const renderDots = () => {
                                        if (dayEvents.length === 0) return null;
                                        if (dayEvents.length >= 5) {
                                            return (
                                                <div className="dot-plus-container mt-0.5">
                                                    <div className={`dot ${dayEvents[0].type}`}></div>
                                                    <span className="text-[9px] text-slate-400 font-mono leading-none tracking-tighter">+{dayEvents.length - 1}</span>
                                                </div>
                                            );
                                        } else {
                                            return (
                                                <div className="grid grid-cols-2 gap-0.5 mt-0.5">
                                                    {dayEvents.map((evt, idx) => (<div key={idx} className={`dot ${evt.type}`}></div>))}
                                                </div>
                                            );
                                        }
                                    };

                                    return (
                                        <div key={i} onClick={() => setSelectedDate(thisDate)} className={`day-cell ${isToday ? 'day-today' : ''} ${isSelected && !isToday ? 'day-selected' : ''}`}>
                                            <span className={`z-10 font-bold ${numColor}`}>{day}</span>
                                            <div className="dot-wrapper">{renderDots()}</div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                        
                        {/* Event List */}
                        <div className="flex-1 flex flex-col justify-start border-t border-white/10 pt-0 relative min-h-0">
                            <button onClick={handleLoadPrev} disabled={visibleRange.start === 0} className="list-nav-btn shrink-0 mb-1">
                                {visibleRange.start > 0 && <Icons.ArrowUp />}
                            </button>
                            
                            <div className="flex-1 overflow-y-auto no-scrollbar space-y-1 pb-4">
                                {visibleEvents.length === 0 ? (
                                    <div className="h-full flex flex-col items-center justify-center text-dim text-xs italic opacity-60">
                                        <span>{debugMsg ? debugMsg : "일정이 없습니다."}</span>
                                    </div>
                                ) : (
                                    <>
                                        {visibleEvents.map((evt, idx) => {
                                            const isPast = isEventPast(evt, selectedDate);
                                            return (
                                                <div key={idx} className={`event-card ${isPast ? 'event-past !min-h-0 py-1.5' : 'min-h-[46px]'}`}>
                                                    <div className={`w-1.5 rounded-full mr-3 shrink-0 ${evt.type} ${isPast ? 'h-3' : 'h-8'}`}></div>
                                                    <div>
                                                        <div className={`text-xs font-bold ${isPast ? 'text-slate-300 mb-0' : 'text-white mb-0.5'}`}>{evt.title}</div>
                                                        {!isPast && (<div className="text-[10px] font-mono text-slate-400">{evt.startTime} - {evt.endTime}</div>)}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </>
                                )}
                            </div>

                            <button onClick={handleLoadNext} disabled={visibleRange.end >= currentDayEvents.length} className="list-nav-btn shrink-0 mt-1">
                                {visibleRange.end < currentDayEvents.length && <Icons.ArrowDown />}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
</body>
</html>
